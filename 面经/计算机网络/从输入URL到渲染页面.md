# 一、DNS 解析：URL 解析成 IP 地址和对应的端口号

浏览器先检查自身缓存中有没有被解析过的这个域名对应的 IP 地址，如果有，解析结束；

如果浏览器缓存中没有命中，浏览器会检查操作系统缓存中有没有对应的已解析过的结果。而操作系统也有一个域名解析的过程。在 Windows 中可通过 C 盘里一个叫 hosts 的文件来设置，如果你在这里指定了一个域名对应的 IP 地址，那浏览器会首先使用这个 IP 地址。

接着请求本地域名服务器（LDNS）来解析这个域名，如果本地 DNS 服务器缓存也没有命中，那么本地 DNS 服务器将把该查询报文转发给根 DNS 服务器；

根 DNS 服务器返回给本地 DNS 服务器一个所查询域的顶级 DNS 服务器的 IP ；

本地 DNS 服务器再向上一步获得的顶级 DNS 服务器 IP 发送解析请求；

接受请求的顶级 DNS 服务器查找并返回此域名对应的 Name Server 域名服务器（也叫权威 DNS 服务器）的 IP 地址，这个 Name Server 服务器就是我要访问的网站域名提供商的服务器，其实该域名的解析任务就是由域名提供商的服务器来完成。

Name Server 服务器会查询存储的域名和 IP 的映射关系表，再把查询出来的域名和 IP 地址等等信息，连同一个 TTL 值返回给本地DNS服务器。

返回该域名对应的 IP 和 TTL 值，本地 DNS 服务器会缓存这个域名和 IP 的对应关系，缓存时间由 TTL 值控制。

# 二、建立 TCP 连接：通过三次握手与服务器建立连接，然后进行数据传输

* 第一次握手，发送 SYN 报文。
    客户端主动向服务器发送请求建立连接的报文 SYN，客户端会随机初始化一个序列号 x，然后把 SYN 的标志置为 1，之后客户端处于 SYN-SENT 的状态。
    SYN=1 seq=x

* 第二次握手，发送 SYN + ACK 报文。
    服务端接收到客户端的报文后，服务端也会随机初始化一个序列号 y，对请求的应答做响应，即 ack=x+1，接着把 SYN 和 ACK 的标志置为 1，之后服务端处于 SYN-RCVD 状态。
    SYN=1 ACK=1 seq=y ack=x+1

* 第三次握手，发送 ACK 报文。
    客户端接受到服务端的报文后，对应答号进行回应 ack=y+1，把 ACK 的标志置为 1，序列号为 x+1，返回确认的报文给服务端，服务端接到确认报文后进入连接的状态，此时 TCP 连接成功。
    ACK=1 ack=y+1 seq=x+1

# 三、客户端发送 HTTP 请求：把输入的地址封装成 HTTP Request 请求行，发送给服务器

请求行 = 请求方法 + 请求url + HTTP版本 + 请求头。

# 四、服务端返回资源

服务器收到请求后，响应报文，返回资源。

# 五、浏览器解析并渲染页面

浏览器解析 HTML 代码, 并请求 HTML 代码中的资源（如js、css、img等），边解析边渲染。

1. html 被 html 解析器解析成 DOM Tree，css 被 css 解析器解析成 CSSOM Tree（并行解析）；
2. DOM Tree 和 CSSOM Tree 合并到一起，形成 Render Tree ；
3. 回流，根据渲染树计算出每个节点的几何信息，位置及大小；
4. 重绘，绘制渲染出最终的页面。

# 六、断开TCP连接：通过四次挥手断开连接

* 第一次挥手，发送 FIN 报文。
    客户端发送 FIN=1，序列号 seq=x 的报文，进入 FIN_WAIT_1 的状态。

* 第二次挥手，服务端发送 ACK 报文。
    服务端接受到客户端报文后，会给客户端发送一个 ACK 的报文，表示收到了。服务端进入 CLODED_WAIT 状态，客户端进入 FIN_WAIT_2 状态。

* 第三次挥手，服务端发送 FIN 报文。
    服务端处理完数据，也会向客户端发送一个 FIN 报文，服务端进入 LAST_ACK 状态。

* 第四次挥手，客户端发送 ACK 报文。
    客户端收到服务端 FIN 报文后，会向服务端发送一个 ACK 的报文，表示收到了。然后客户端进入 TIME_WAIT 状态，服务端收到 ACK 报文后进入 CLOSED 状态。至此连接断开。