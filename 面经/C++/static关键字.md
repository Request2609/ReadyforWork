# static变量的初始化

在C和C++中静态局部变量的初始化节点有点不太一样。

在C中，初始化发生在代码执行之前，编译阶段分配好内存之后，就会进行初始化，所以我们看到在C语言中无法使用变量对静态局部变量进行初始化，在程序运行结束，变量所处的全局内存会被全部回收。

而在C++中，初始化时在执行相关代码时才会进行初始化，主要是由于C++引入对象后，要进行初始化必须执行相应构造函数和析构函数，在构造函数或析构函数中经常会需要进行某些程序中需要进行的特定操作，并非简单地分配内存。所以C++标准定为全局或静态对象是有首次用到时才会进行构造，并通过atexit()来管理。在程序结束，按照构造顺序反方向进行逐个析构。所以在C++中是可以使用变量对静态局部变量进行初始化的。

# 静态成员变量

**作用：**使用静态成员变量来实现多个对象共享数据的目标。一个类中可以有一个或多个静态成员变量，所有的对象都共享这些静态成员变量，都可以引用它。静态成员变量既可以通过对象名访问，也可以通过类名访问，但要遵循 private、protected 和 public 关键字的访问权限限制。当通过对象名访问时，对于不同的对象，访问的是同一份内存。

**特点：**

（1）static 成员变量不占用对象的内存，而是在所有对象之外开辟内存，即使不创建对象也可以访问。具体来说，static 成员变量和普通的 static 变量类似，都在内存分区中的全局数据区分配内存。

（2）static 成员变量的内存既不是在声明类时分配，也不是在创建对象时分配，而是在（类外）初始化时分配。反过来说，没有在类外初始化的 static 成员变量不能使用。初始化的时候不能再加static。只能在声明的时候加上。

（3）静态成员变量必须初始化，而且只能在类体外进行。例如：int Student::m_total = 10;初始化时可以赋初值，也可以不赋值。如果不赋值，那么会被默认初始化为 0。全局数据区的变量都有默认的初始值 0，而动态数据区（堆区、栈区）变量的默认值是不确定的，一般认为是垃圾值。

（4）静态全局变量只能作用在本文件中，不能跨文件。静态局部变量只能作用于该局部函数中，虽然函数结束后该变量还存在，但是不能再调用。静态局部变量多用于循环调用某个函数时使用。

# 静态成员函数

可以说静态成员函数的出现就是为了处理静态成员变量的。静态成员变量属于类（被存放在全局区中），不属于某个具体的对象（具体对象的内存是分配在堆中的），即使创建多个对象，也只为该变量分配一次内存，所有对象使用的都是这份内存中的数据。

静态成员函数与普通成员函数的根本区别在于：普通成员函数有 this 指针，可以访问类中的任意成员；而静态成员函数没有 this 指针，只能访问静态成员（包括静态成员变量和静态成员函数）另外相比普通成员函数，不管有没有创建对象，主函数都可以调用静态成员函数。

（1）静态成员函数只能访问静态成员变量。只能去调用其他静态成员函数。

（2）相比普通成员函数，不管有没有创建对象，主函数都可以调用静态成员函数。

**静态成员函数可以设置为virtual吗？为什么？**

（1）static成员不属于任何类对象或类实例，所以即使给此函数加上virutal也是没有任何意义的。

（2）静态与非静态成员函数之间有一个主要的区别，那就是静态成员函数没有this指针。

虚函数依靠vptr和vtable来处理。vptr是一个指针，在类的构造函数中创建生成，并且只能用this指针来访问它，因为它是类的一个成员，并且vptr指向保存虚函数地址的vtable。

对于静态成员函数，它没有this指针，所以无法访问vptr，这就是为何static函数不能为virtual。