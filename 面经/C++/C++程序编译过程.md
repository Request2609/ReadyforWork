# C++程序的编译过程

C++和C语言类似，一个C++程序从源码到执行文件，有四个过程，**预编译、编译、汇编、链接**。

## 预编译

（1） 将所有的#define删除，并且展开所有的宏定义

（2） 处理所有的条件预编译指令，如#if、#ifdef

（3） 处理#include预编译指令，将被包含的文件插入到该预编译指令的位置。

（4） 过滤所有的注释

（5） 添加行号和文件名标识。

将.cpp文件转化成.i文件
使用的g++命令是：g++ –E
对应于预处理命令：cpp

## 编译

（1） 词法分析：将源代码的字符序列分割成一系列的记号。

（2） 语法分析：对记号进行语法分析，生成抽象语法树。

（3） 语义分析：判断表达式是否有意义。

（4） 中间代码生成：

（5） 代码优化及目标代码生成：生成汇编代码。

将.cpp/.h文件转换成.s文件
使用的g++命令是：g++ –S
对应于编译命令：cc –S

## 汇编

汇编过程实际上指把汇编语言代码翻译成目标机器指令的过程。对于被翻译系统处理的每一个C语言源程序，都将最终经过这一处理而得到相应的目标文件。目标文件中所存放的也就是与源程序等效的目标的机器语言代码。

将.s文件转化成.o文件
使用的g++命令是：g++ –c
对应于汇编命令是：as

## 链接

将不同的源文件产生的目标文件进行链接，从而形成一个可以执行的程序。

链接分为静态链接和动态链接。

**静态链接：** 在链接的时候就已经把要调用的函数或者过程链接到了生成的可执行文件中，就算去把静态库删除也不会影响可执行程序的执行。生成的静态链接库，Windows下以.lib为后缀，Linux下以.a为后缀。

**动态链接：** 在链接的时候并没有把调用的函数代码链接进去，而是在执行的过程中，再去找要链接的函数，生成的可执行文件中没有函数代码，只包含函数的重定位信息，所以当你删除动态库时，可执行程序就不能运行。生成的动态链接库，Windows下以.dll为后缀，Linux下以.so为后缀。

将.o文件转化成可执行程序
使用的g++命令是：g++
对应于链接命令是：ld